# PES Data
This directory doesn't contain the parent datasets used to create the state-specific files, due to file size limitations, but the empty directories where data should be stored are labeled in each scripts header under "Parent dirs". See `../scripts/` dir for further details.

We also include example templates in 'INPUT_TEMPLATES' for each model that can be modified by hand or with a script similar to how the state-specific files were created. See '../scripts/XXX.R' for further demonstration.

## Parent datasets
### Between Node Mobility Networks - `ct_ak_crosswalks.r` and `county_mobility_timeseries_post2020census.r` 
1. [Alaska](https://www.census.gov/programs-surveys/geography/technical-documentation/county-changes.2010.html#list-tab-957819518) split one county into 2 in 2019, but this change was not commonly used until after the pandemic and 2020 census. We created this crosswalk manually by determining the proportion of the 2019-2023 ACS population in each new county (69% and 31% split). 
2. [Connecticut](https://www.census.gov/programs-surveys/geography/technical-documentation/county-changes.January_2020.html) changed their county names and boundaries in 2023 to Planning Regions. [GeoCorr 2022](https://mcdc.missouri.edu/applications/geocorr2022.html) provides crosswalks across US boundaries including a Connecticut pre-2023 boundary under "Other geographies". CT crosswalk in `post2020_county_mobility_flow/connecticut_county_crosswalk_geocorr2022.csv` and combined with AK in `post2020_county_mobility_flow/ak_ct_crosswalk.csv`
3. With the county crosswalk created, we translated each day of the 2019 SafeGraph county mobility visits to 2023 census boundaries and reduced the data to only within-state pairs. The AK and CT conversion created some rounding errors in population increasing the total daily flow by 40-50 people. The estimated  population traveling each day far exceed the 2019-2023 census estimates of the population within each county, because cell-phone data captures flow of non-residents. We used the fraction of the total outflow per county to derive the proportions of the population traveling. We grouped travel by quarter of the year and provide all 4, but Q4 is likely the most appropriate for modeling the influenza season in the US. Future code iterations may allow daily mobility matrices, but currently an average one is used for the entire time series. We also provide `STATE/STATE_quarterly-2019_county-connection-ranking.csv` with the total people flowing out of a county each day to help target which counties may have the largest impact on the community when infections are seeded there. Created datasets can be found in `post2020_county_mobility_flow/` and their respective `STATE` directories.

### High Risk Ratios - `Flu_HighRisk_by_AgeGrp.R` and `high_risk_county.r`
1. [Behavioral Risk Factor Surveillance System (BRFSS)](https://www.cdc.gov/brfss/annual_data/annual_data.htm) is a continual survey released annually of Americans 18+ to estimate the proportion of the population experiencing comorbidities and taking part in risky behaviors such as smoking. We use the [CDC's list of comorbidities](https://www.cdc.gov/flu/highrisk/index.htm) that increase the risk of hospitalization and death for adults to pull out the proportion of the population with at least one comorbidity and do not scale risk by multiple comorbidities. Anyone 65+ is technically high risk due to age, but we leave this to the user and estimate comorbid risk for this age group the same as 18-49 and 49-64. Original data in `BRFSS/LLCP202*.XPT`, both 2022 and 2023 are needed because Kentucky and Pennsylvania did not collect enough data in 2023.
2. [National Survey of Children's Health (NSCH)](https://www.census.gov/programs-surveys/nsch/data/datasets.2023.html) surveys parents to assess the comorbidity burden of children 17 and under. The CDC provides a [separate list of high risk comorbidities for children](https://www.cdc.gov/flu/highrisk/neurologic-pediatric.html). Both BRFSS and NSCH provide the respondent's age group, current state, strata and primary sampling unit to allow for adjusted prevalence estimates. Original data in `NSCH/nsch_2023e_topical.sas7bdat`.
3. [Social Vulnerability Index (SVI) 2022 release](https://www.atsdr.cdc.gov/place-health/php/svi/svi-data-documentation-download.html) is derived from the 5-year American Community Survey based on 16 factors that increase someone's likelihood of suffering or struggling to recover after a natural disaster, such as a hurricane or pandemic. It is a percentile rank that will always have a lowest vulnerability (0) and highest (1), so we use the US level ranking rather than state specific to compare the SVI at county-level to the CDC PLACES data below. Original data in `SVI_2022_US_county.csv`.
4. [CDC PLACES](https://www.cdc.gov/places/index.html) combines BRFSS, ACS and SVI with other datasets to generate county, census tract, and ZIP Code Tabulation Area (ZCTA)-level estimates of the proportion of different comorbidities and risky behaviors. It does not, however, provide the proportion of the population with at least 1 high risk influenza comorbidity at these granular levels. Original data in `PLACES__Local_Data_for_Better_Health,_County_Data_2024_release_20251014.csv`.

The only core stipulation of the county-level high risk ratios is their mean needs to re-create the mean high risk of the state by age group, but otherwise it is a hypothesis how risk is distributed across a state. Some notes on our choice:
- SVI isn't directly used here to allocate risk, but we only kept comorbidities that linearly increased with SVI. Cancer prevalence was the only comorbidity negatively associated with SVI as it includes skin cancer, a disease typical of white, affluent people. While chronic kidney disease prevalence was not included in the 2024 release. A full list of comorbidities included is found in the code. 
- We assume the risk distribution for children is the same as adults, since PLACES is only available for 18+ population.
- We square-root the raw sum of county comorbidity prevalences to limit the influence of high-burden counties, e.g. prevalences of 1.5 and 2.5 become 1.22 and 1.58, respectively. Using the raw burden would also be valid but there is a larger range of the county min and max high risk ratios.

We carried out the following steps per state ($s$) and age group ($a$). First, we sum the PLACES county-level age-adjusted comorbidity prevalences to get the total raw burden ($p_{s,a,c}$) and square-root ($q_{s,a,c}$) to dampen extremes. State high risk ratios can be thought of as the proportion of the state by age group with at least 1 influenza high risk comorbidity, so we can use this to normalize the absolute prevalence sums. Second, we estimate each county's proportion of the total state population ($w_{s,a,c}$) and compute a weighted average to get the mean burden of the state ($b_{s,a} = \sum_{c} q_{s,a,c} * w_{s,a,c}$). Lastly, each county receives a relative burden weight ($r_{s,a,c} = q_{s,a,c} / b_{s,a}$) and we allocate the county-level high risk prevalence ($h_{s,a,c} = h_{s,a} * r_{s,a,c}$). The allocation method ensures $\sum_{c} w_{s,a,c} * h_{s,a,c} = h_{s,a}$. 

## State-specific Dirs
Each state-specific directory has the files needed to run a SEIHRD model with and without vaccination parameterized for H1N1. We assume epidemics begin on Oct. 1 (day0 parameter in `5_vaccine_coverage_by_state.R`) and last 212 days (simulation_days parameter in `6_create_input_files_and_parallel_commands.R`). The initial infected are placed in the largest age group (low risk, 18-49yr) based on 1 per 1M of the state population, always rounding up to the nearest integer. The lower the initial infected the more stochasticity in final epidemic size. For example, Alaska's population was less than 1M in the in the 2019-2023 5-yr ACS, so only 1 person seeds the simulation. The likelihood a single person can infect enough people to start an epidemic depends on the inter-node mobility, within-node contact structure, disease itself (e.g. R0), and everyone's susceptibility to infection (usually 1 for all ages).
